"use strict";(self.webpackChunkrobinlinacre=self.webpackChunkrobinlinacre||[]).push([[5436],{3065:function(e,t,n){n.r(t),n.d(t,{Head:function(){return m},default:function(){return h}});var a=n(1151),r=n(7294),i=n(7506),l=n(7825),o=n(6760),s=(n.p,n(2692)),c=n(6702);const m=e=>r.createElement(l.H,{frontmatter:e.pageContext.frontmatter});function u(e){const t=Object.assign({h1:"h1",p:"p",a:"a",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",h2:"h2",ul:"ul",li:"li",span:"span",strong:"strong",h3:"h3"},(0,a.ah)(),e.components);return r.createElement(r.Fragment,null,r.createElement(c.Z,{frontmatter:e.pageContext.frontmatter}),"\n",r.createElement(t.h1,null,"The Intuition Behind the Use of Expectation Maximisation to Train Record Linkage Models"),"\n",r.createElement(o.Z,null,r.createElement(t.p,null,"How unsupervised learning is used to estimate model parameters in Splink")),"\n",r.createElement(t.p,null,r.createElement(t.a,{href:"http://github.com/moj-analytical-services/splink"},"Splink")," is a free probabilistic record linkage library that predicts the likelihood that two records refer to the same entity. For example, what is the probability that the following two records match?"),"\n",r.createElement(t.table,null,r.createElement(t.thead,null,r.createElement(t.tr,null,r.createElement(t.th,null,"first_name"),r.createElement(t.th,null,"surname"),r.createElement(t.th,null,"dob"),r.createElement(t.th,null,"city"),r.createElement(t.th,null,"email"))),r.createElement(t.tbody,null,r.createElement(t.tr,null,r.createElement(t.td,null,"lucas"),r.createElement(t.td,null,"smith"),r.createElement(t.td,null,"1984-01-02"),r.createElement(t.td,null,"London"),r.createElement(t.td,null,"lucas.smith@hotmail․com")),r.createElement(t.tr,null,r.createElement(t.td,null,"lucas"),r.createElement(t.td,null,"smith"),r.createElement(t.td,null,"1983-02-12"),r.createElement(t.td,null,"Manchester"),r.createElement(t.td,null,"lucas.smith@hotmail․com")))),"\n",r.createElement(t.p,null,"The underlying statistical model is called the Fellegi Sunter model. It works by computing partial match weights, which are a measure of the importance of the different columns in computing the probability of a match. For example, the match on ‘Smith’ is less important than the match on email in the above example."),"\n",r.createElement(t.p,null,"However, there’s a paradox at the heart of the problem of training a record linkage model: To estimate the parameters of the model, you need to know which records match. But finding which records match is the whole problem you’re trying to solve. Manual labelling of comparisons is error prone and costly so isn’t a great option."),"\n",r.createElement(t.p,null,"The Expectation Maximisation (EM) algorithm provides a solution to this paradox. This post provides an intuitive explanation for how this works, and some details of how it’s implemented in ",r.createElement(t.a,{href:"https://github.com/moj-analytical-services/splink"},"Splink"),", our software for record linkage at scale. For a more formal treatment, see the",r.createElement(t.a,{href:"https://imai.fas.harvard.edu/research/files/linkage.pdf"}," FastLink paper.")),"\n",r.createElement(t.h2,null,"The EM Approach"),"\n",r.createElement(t.p,null,"The parameters of a record linkage model — the m and the u probabilities — can be calculated from the aggregate characteristics of matching records and non-matching records respectively. (For a fuller treatment of m and u probabilities, I recommend reading ",r.createElement(t.a,{href:"https://www.robinlinacre.com/maths_of_fellegi_sunter/"},"this blog post"),".) Once these values are known, the model is usually able accurately to predict which records match."),"\n",r.createElement(t.p,null,"The key to the EM approach is leveraging the fact that matching and non-matching record comparisons form two fairly distinct ‘clusters’:"),"\n",r.createElement(t.ul,null,"\n",r.createElement(t.li,null,"\n",r.createElement(t.p,null,"Amongst matching record comparisons, the information in most or all columns in the two records usually matches."),"\n"),"\n",r.createElement(t.li,null,"\n",r.createElement(t.p,null,"Amongst non-matching record comparisons, the information in most or all columns in the two records usually does not match"),"\n"),"\n"),"\n",r.createElement(t.p,null,"This results in a bimodal distribution of record comparisons:"),"\n",r.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/new_website_draft/static/7f39a94f771ce3a2deede01f127ce9d4/aa440/decision_boundary.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 37.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVR42k1Q207CQBTk/z/AFx/REBASRYMhIoUoFwkSCzwUKCIUrG3pbS/t7rbbuqVGnWxO5uycOSeZQpomk+UehiwVLP1DFEUQQoxxkiT8JNiIfbpEEJ5kEKQg+GVz1p3D3CM+c8G2j4qiqOqaUCragxtWnsBkHeQzOTJzo/9RbJKhEmIa/2o+gI7r+p7HOZN3qNiC1x0+3zKMfLHRsizOuTDH9YFek5L7ftIYsvmW0ogLcxgSsUbQ8YrWOqz1kl7Uvx5fTWF+k2VN0wAA2eWS9H52Y5Tb3lU3LD7g6jPoLeBoeRws/GrPL7VxRQrKEjq/de7GDo+paVqGYWSXWcyXujfdORsTrQysGnjvEN1lBwvqLp3tkWpiWQNTDYw23trE/3MtOJhZiObVRtQLmIuZaAkhMeeQRAGL8xdGXNRTKD9pfwO1YYKaWIFeCQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Conceptual diagram of the bimodal distribution of pairwise record comparisons. Diagram by author."\n        title=""\n        src="/new_website_draft/static/7f39a94f771ce3a2deede01f127ce9d4/c1b63/decision_boundary.png"\n        srcset="/new_website_draft/static/7f39a94f771ce3a2deede01f127ce9d4/5a46d/decision_boundary.png 300w,\n/new_website_draft/static/7f39a94f771ce3a2deede01f127ce9d4/0a47e/decision_boundary.png 600w,\n/new_website_draft/static/7f39a94f771ce3a2deede01f127ce9d4/c1b63/decision_boundary.png 1200w,\n/new_website_draft/static/7f39a94f771ce3a2deede01f127ce9d4/aa440/decision_boundary.png 1500w"\n        sizes="(max-width: 1200px) 100vw, 1200px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",r.createElement(t.p,null,"This separation between matches and non-matches means it’s relatively easy to come up with a rough decision rule that is able to correctly identify most matches and most non-matches. For instance, we could simply count the number of columns that match (first name surname, and so on), and predict a match for any record pair where more than half of them match."),"\n",r.createElement(t.p,null,"This is fundamental to resolving our paradox: We've just found a way to designate matches and non matches without any labeled data (i.e. unsupervised learning)."),"\n",r.createElement(t.p,null,"Now that we have designated each record comparison as a match or a non match, we can use this information to estimate the implied m and u parameters of the model. And this enables us to iteratively improve this decision rule, using the following algorithm:"),"\n",r.createElement(t.p,null,r.createElement(t.strong,null,"Expectation step:")," Use the estimated model parameters to predict which record comparisons are matches"),"\n",r.createElement(t.p,null,r.createElement(t.strong,null,"Maximisation step:")," Use the predictions to re-estimate the model parameters"),"\n",r.createElement(t.p,null,"In this example, our initial decision rule worked by simply counting the number of columns with matching information. As such, we gave equal weight to every column. Clearly there is room for improvement in this rule — in reality a match on a postcode column is more important than a match on gender."),"\n",r.createElement(t.p,null,"In the first maximisation step, the expectation maximisation process will immediately begin to learn these weights. For example, it will recognise that, amongst non-matches there are many record comparisons which match on gender, but few that match on postcode. This will be represented in the re-computed m and u probabilities, and in the next iteration, greater weight will be placed on a match on postcode than gender."),"\n",r.createElement(t.p,null,"At each iteration, the decision rule will be refined as the model makes fewer mistakes, and the weights therefore become more accurate."),"\n",r.createElement(t.p,null,"Convergence occurs when the parameter estimates stabilise, and there are no longer any changes to parameter estimates between iterations."),"\n",r.createElement(t.p,null,"It turns out this algorithm is equivalent to maximising the likelihood function of the Fellegi-Sunter model (although note that it is only guaranteed to converge to a local maxima, not necessarily a global one)."),"\n",r.createElement(t.h2,null,"A caveat around the decision boundary"),"\n",r.createElement(t.p,null,"In the above, to build intutiion, I describe concrete decision boundary that classifies each record comparison as either a match or a non match. The m and u values calculated in the maximisation step are based on the counts of matches and non-matches that result from this binary classifier."),"\n",r.createElement(t.p,null,"In reality, we can improve on this, because using a decision boundary throws away some of the information in the match probability: it treats an uncertain match in the same way as a highly probable match."),"\n",r.createElement(t.p,null,"There's a simple modification to the methodology that accounts for this. We can use the match probability directly, rather than applying the decision bondary. For example, if a record comparison has a 70% match probability, in the maximisation step this can be treated as 0.3 non-matching records and 0.7 matching records. So when the m and u probabilities are recomputed in the maximisation step, we use the sum of probabilities rather than counts of matches and non matches."),"\n",r.createElement(t.h2,null,"How the EM approach is implemented in Splink"),"\n",r.createElement(t.p,null,"In Splink, a few modifications to the above process are made that, in practice, result in faster convergence and a greater likelihood of convergence to a global maxima."),"\n",r.createElement(t.h3,null,"Estimating the u probabilities"),"\n",r.createElement(t.p,null,"Whilst it is possible to estimate u probabilities using the EM approach, we recommend an ",r.createElement(t.a,{href:"https://moj-analytical-services.github.io/splink/linker.html#splink.linker.Linker.estimate_u_using_random_sampling"},"alternative estimation procedure")," in Splink which is usually more accurate."),"\n",r.createElement(t.p,null,"Recall that the u probabilities represent the probability that we observe matching columns amongst truly non-matching records. For example, how often do we observe the coincidence that two different people have the same first name?"),"\n",r.createElement(t.p,null,"We can estimate the u probabilities by taking random pairwise record comparisons, assuming they do not match, and computing how often these coincidences occur. Since the probability of two random records being a match (representing the same entity) is usually very low, then this will yield good estimates of u values."),"\n",r.createElement(t.p,null,"An additional benefit of this approach is that if the u probabilities are correct, it ‘anchors’ the EM estimation procedure and greatly improves the chance of it converging to a global, rather than local, maximum."),"\n",r.createElement(t.h3,null,"Starting values and the initial decision boundary"),"\n",r.createElement(t.p,null,"In the above, we suggested a simple decision rule for the first step of EM: count the number of matching columns, and designate as a match any comparison where more than half of fields match."),"\n",r.createElement(t.p,null,"In reality, it’s possible to begin with a decision rule which is usually more accurate, leading to faster convergence. Specifically, the initial decision rule uses the u probabilities that have been estimated using the random sampling procedure described above, and ‘sensible default’ starting values for the m probabilities ."),"\n",r.createElement(t.p,null,"You can see all of this at work in practice in some of our ",r.createElement(t.a,{href:"https://moj-analytical-services.github.io/splink/examples_index.html"},"example notebooks"),"."),"\n",r.createElement(t.h2,null,"Conclusion"),"\n",r.createElement(t.p,null,"EM is a powerful tool for estimating the parameters of probabilistic linkage models in the Fellegi Sunter framework. In our experience, the EM approach works best when it is used to estimate the m probabilities of the model only, following estimation of the u probabilities using random sampling, and estimating the ",r.createElement(t.a,{href:"https://moj-analytical-services.github.io/splink/settings_dict_guide.html#probability_two_random_records_match"},"prior")," using a ",r.createElement(t.a,{href:"https://moj-analytical-services.github.io/splink/linkerest.html#splink.linker.Linker.estimate_probability_two_random_records_match"},"direct estimation techique"),"."),"\n",r.createElement(s.Z,{frontmatter:e.pageContext.frontmatter}))}var h=function(e){return void 0===e&&(e={}),r.createElement(i.fE,e,r.createElement(u,e))}},6702:function(e,t,n){var a=n(7294),r=n(4160);t.Z=e=>{var t,n,i,l,o,s;let{frontmatter:c}=e;const{tutorial_number:m}=c,u=(0,r.K2)("4236107564"),h=u.allMdx.edges.map((e=>e.node.frontmatter.tutorial_number)),d=h.includes(m-1),p=h.includes(m+1),f=null===(t=u.allMdx.edges.find((e=>e.node.frontmatter.tutorial_number===m-1)))||void 0===t||null===(n=t.node)||void 0===n||null===(i=n.fields)||void 0===i?void 0:i.slug,b=null===(l=u.allMdx.edges.find((e=>e.node.frontmatter.tutorial_number===m+1)))||void 0===l||null===(o=l.node)||void 0===o||null===(s=o.fields)||void 0===s?void 0:s.slug;return a.createElement("div",{className:"bg-gray-100 p-2 mt-2 mb-2 italic rounded-md text-gray-600 text-xs"},a.createElement("div",{className:"flex justify-between"},a.createElement("div",{className:"w-1/3 text-left"},d&&a.createElement(r.rU,{to:f,className:"text-blue-500 hover:underline"},"← Previous article")),a.createElement("div",{className:"w-1/3 text-center"},a.createElement("span",null,"This is part ",m," of the tutorial")),a.createElement("div",{className:"w-1/3 text-right"},p&&a.createElement(r.rU,{to:b,className:"text-blue-500 hover:underline"},"Next article →"))))}},137:function(e,t,n){n.d(t,{A:function(){return c},Z:function(){return m}});var a=n(7294),r=n(4160),i=n(9583);var l=e=>{let{text:t,IconComponent:n,route:i}=e;const{0:l,1:o}=(0,a.useState)(null);return(0,a.useEffect)((()=>{if("undefined"!=typeof window){o(window.innerWidth);const e=()=>o(window.innerWidth);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}}),[]),null===l?null:a.createElement("div",null,a.createElement(r.rU,{to:i,className:"text-gray-600 hover:text-blue-700 transition ease-in duration-200"},l>500?t:a.createElement(n,{className:"w-4.5 h-4.5"})))};var o=()=>a.createElement("div",null,a.createElement("div",{className:"flex justify-between items-center py-4"},a.createElement("div",{className:"flex items-center space-x-4"},a.createElement("div",{className:"text-base font-mono font-semibold shimmer-text"},a.createElement(r.rU,{to:"/",className:"text-base font-mono font-bold shimmer-text"},">robinlinacre"))),a.createElement("div",{className:"flex items-center space-x-3"},a.createElement(l,{text:"Home",IconComponent:i.xng,route:"/"}),a.createElement(l,{text:"About",IconComponent:i.DAO,route:"/about"}),a.createElement("a",{href:"https://twitter.com/robinlinacre",className:"text-gray-600 hover:text-blue-700 transition ease-in duration-200",target:"_blank",rel:"noopener noreferrer"},a.createElement(i.fWC,{className:"w-4.5 h-4.5"})),a.createElement("a",{href:"https://github.com/robinl",className:"text-gray-600 hover:text-blue-700 transition ease-in duration-200",target:"_blank",rel:"noopener noreferrer"},a.createElement(i.hJX,{className:"w-4.5 h-4.5"})),a.createElement("a",{href:"https://www.linkedin.com/in/robinlinacre/",className:"text-gray-600 hover:text-blue-700 transition ease-in duration-200",target:"_blank",rel:"noopener noreferrer"},a.createElement(i.ltd,{className:"w-4.5 h-4.5"})))),a.createElement("hr",{className:"border-gray-300 mb-4"}));var s=()=>a.createElement("div",{className:"text-center"},a.createElement("hr",{className:"border-gray-300"}),a.createElement("footer",{className:"mt-4"},a.createElement("p",{className:"text-sm text-gray-500"},a.createElement("a",{href:"/"},"Back home")),a.createElement("p",{className:"text-sm text-gray-500"},"This site is built using"," ",a.createElement("a",{href:"https://observablehq.com"},"Observable HQ")," and"," ",a.createElement("a",{href:"https://gatsbyjs.org"},"Gatsby.js"),". Source code"," ",a.createElement("a",{href:"https://github.com/robinl/robinlinacre"},"here"),".")));function c(e){let{children:t,pageContext:n,className:r}=e;return a.createElement(a.Fragment,null,a.createElement("div",{className:r||"text-base mx-auto w-full max-w-prose px-4"},a.createElement(o,null),a.createElement("div",null,t),a.createElement(s,null)))}var m=c},7506:function(e,t,n){n.d(t,{fE:function(){return c},pY:function(){return m}});var a=n(7294),r=n(1151),i=n(137);var l=e=>{let{frontmatter:t}=e;const{post_date:n,code_url:r,post_latest_update:i}=t;let l="View source code for this page";return r.includes("observablehq.com")&&(l="Live edit this notebook"),a.createElement("p",{className:"text-gray-400 text-sm"},"Originally posted: ",n,"."," ",i&&" Last updated: "+i+"."," ",l," ",a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm"},"here."))},o=n(5589);const s={pre:e=>a.createElement("div",e),code:e=>{let{children:t,className:n}=e;if(!n)return a.createElement("code",null,t);const r=n.replace(/language-/,"");return a.createElement("div",{className:"mb-8 mt-8"},a.createElement(o.y$,{code:t.trim(),language:r,theme:o.np.vsDark},(e=>{let{className:t,style:n,tokens:r,getLineProps:i,getTokenProps:l}=e;return a.createElement("pre",{className:t,style:{...n,padding:"20px",fontSize:"0.8em"}},r.map(((e,t)=>a.createElement("div",Object.assign({key:t},i({line:e,key:t})),e.map(((e,t)=>a.createElement("span",Object.assign({key:t},l({token:e,key:t})))))))))})))}};function c(e){let{children:t,pageContext:n}=e;const{frontmatter:o}=n;return a.createElement(i.Z,null,a.createElement(r.Zo,{components:s},a.createElement(l,{frontmatter:o}),a.createElement("div",{id:"mdx-container-div"},t)))}function m(e){let{children:t,pageContext:n}=e;const{frontmatter:o}=n;return a.createElement(i.Z,{className:"text-base mx-auto w-full max-w-screen-lg px-4"},a.createElement(r.Zo,{components:s},a.createElement(l,{frontmatter:o}),a.createElement("div",{id:"mdx-container-div"},t)))}},7825:function(e,t,n){n.d(t,{H:function(){return i}});var a=n(7294),r=n(4160);const i=e=>{let{frontmatter:t}=e;const{title:n,description:i,image:l,siteUrl:o,twitterUsername:s}=(0,r.K2)("1865044719").site.siteMetadata,c={title:(null==t?void 0:t.title)||n,description:(null==t?void 0:t.description)||i,image:""+o+((null==t?void 0:t.image)||l),url:""+o+((null==t?void 0:t.pathname)||""),twitterUsername:s,...t};return a.createElement(a.Fragment,null,a.createElement("title",null,c.title),a.createElement("meta",{name:"description",content:c.description}),a.createElement("meta",{name:"image",content:c.image}))}},6760:function(e,t,n){var a=n(7294);t.Z=e=>{let{children:t}=e;const n=a.Children.map(t,(e=>a.isValidElement(e)&&"p"===e.type?e.props.children:e));return a.createElement("h2",{className:"text-lg font-sans font-normal text-gray-500"},n)}},2692:function(e,t,n){var a=n(7294),r=n(4160);t.Z=e=>{let{frontmatter:t}=e;const{tutorial_number:n,title:i}=t,l=(0,r.K2)("1842021157").allMdx.edges.sort(((e,t)=>e.node.frontmatter.tutorial_number-t.node.frontmatter.tutorial_number));return a.createElement("div",{className:"bg-blue-100  p-4 mt-8  mb-4 rounded-lg "},a.createElement("div",{className:"container mx-auto"},a.createElement("div",{className:"text-blue-800 font-semibold text-base mb-2"},"Probabilistic Linkage Tutorial Navigation:"),a.createElement("ol",{className:"space-y-2 text-sm"},l.map((e=>a.createElement("li",{key:e.node.frontmatter.tutorial_number,className:"text-blue-600 text-sm"},n===e.node.frontmatter.tutorial_number?a.createElement("span",{className:"font-bold text-sm"},e.node.frontmatter.title):a.createElement(r.rU,{to:e.node.fields.slug,className:"hover:underline"},e.node.frontmatter.title)))))))}},4405:function(e,t,n){n.d(t,{w_:function(){return c}});var a=n(7294),r={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=a.createContext&&a.createContext(r),l=function(){return l=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},l.apply(this,arguments)},o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function s(e){return e&&e.map((function(e,t){return a.createElement(e.tag,l({key:t},e.attr),s(e.child))}))}function c(e){return function(t){return a.createElement(m,l({attr:l({},e.attr)},t),s(e.child))}}function m(e){var t=function(t){var n,r=e.attr,i=e.size,s=e.title,c=o(e,["attr","size","title"]),m=i||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),a.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,c,{className:n,style:l(l({color:e.color||t.color},t.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),s&&a.createElement("title",null,s),e.children)};return void 0!==i?a.createElement(i.Consumer,null,(function(e){return t(e)})):t(r)}},1151:function(e,t,n){n.d(t,{Zo:function(){return o},ah:function(){return i}});var a=n(7294);const r=a.createContext({});function i(e){const t=a.useContext(r);return a.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const l={};function o({components:e,children:t,disableParentContext:n}){let o;return o=n?"function"==typeof e?e({}):e||l:i(e),a.createElement(r.Provider,{value:o},t)}}}]);
//# sourceMappingURL=component---src-mdx-em-intuition-mdx-07f0e9e88591037b2e24.js.map